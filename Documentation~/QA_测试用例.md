# ScreenShotObserver 插件 - QA 测试用例文档

**插件版本**: v1.0.0  
**测试日期**: ___________  
**测试人员**: ___________  
**测试平台**: Android / iOS  

---

## 一、测试环境准备

### 1.1 测试设备要求

| 平台 | 最低要求 | 推荐配置 |
|------|---------|---------|
| Android | Android 5.0 (API 21) | Android 14+ (API 34) 和 Android < 14 各一台 |
| iOS | iOS 9.0 | iOS 13.0+ |

### 1.2 测试前准备

- [ ] 在 Unity Editor 中打开项目
- [ ] 确认 `ScreenShotObserver` 插件已正确导入
- [ ] 确认原生插件文件存在：
  - [ ] `Plugins/Android/ScreenshotLifecycleObserver.java`
  - [ ] `Plugins/iOS/ScreenshotObserver.mm`
- [ ] 构建并安装到测试设备
- [ ] 确认设备已开启开发者模式和 USB 调试（Android）

### 1.3 测试工具准备

- [ ] Unity Editor（用于查看日志）
- [ ] Android Studio Logcat 或 ADB（Android 测试）
- [ ] Xcode Console（iOS 测试）
- [ ] 设备截屏功能正常

---

## 二、功能测试用例

### 测试用例 1：基础功能 - 启动监听（显式参数）

**测试目的**: 验证启动截屏监听功能是否正常

**前置条件**:
- 游戏已启动并进入主界面
- 未启动任何截屏监听

**测试步骤**:
1. 打开 Unity Console 或设备日志工具
2. 在游戏中调用 `ScreenShotObserver.Instance.StartListenScreenShot("NativeMsgRx", "OnScreenshotDetected", true)`
3. 观察日志输出
4. 等待 2 秒
5. 在设备上执行截屏操作（Android：电源键+音量减，iOS：电源键+Home键）
6. 观察日志输出

**预期结果**:
- ✅ 步骤 3：日志中应显示 `[ScreenShotObserver] StartListenScreenShot in editor` 或对应平台的启动日志
- ✅ 步骤 6：日志中应显示截屏检测回调，格式类似 `[ScreenshotCallbackReceiver] Screenshot detected!`

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 2：基础功能 - 启动监听（自定义参数）

**测试目的**: 验证使用自定义参数启动截屏监听功能是否正常

**前置条件**:
- 游戏已启动并进入主界面
- 已创建一个名为 `TestReceiver` 的 GameObject，并添加了包含 `OnCustomScreenshot` 方法的脚本

**测试步骤**:
1. 打开 Unity Console 或设备日志工具
2. 在游戏中调用 `ScreenShotObserver.Instance.StartListenScreenShot("TestReceiver", "OnCustomScreenshot", true)`
3. 观察日志输出
4. 等待 2 秒
5. 在设备上执行截屏操作
6. 观察日志输出

**预期结果**:
- ✅ 步骤 3：日志中应显示启动监听成功的日志，包含自定义的 GameObject 名称和方法名
- ✅ 步骤 6：日志中应显示截屏检测回调，调用的是自定义方法 `OnCustomScreenshot`

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 3：基础功能 - 停止监听

**测试目的**: 验证停止截屏监听功能是否正常

**前置条件**:
- 游戏已启动
- 已成功启动截屏监听

**测试步骤**:
1. 打开 Unity Console 或设备日志工具
2. 在游戏中调用 `ScreenShotObserver.Instance.StopListenScreenShot()`
3. 观察日志输出
4. 等待 2 秒
5. 在设备上执行截屏操作
6. 观察日志输出

**预期结果**:
- ✅ 步骤 3：日志中应显示停止监听的日志
- ✅ 步骤 6：日志中**不应**显示截屏检测回调（因为监听已停止）

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 4：异常处理 - 空参数测试

**测试目的**: 验证传入空参数时的错误处理

**前置条件**:
- 游戏已启动并进入主界面

**测试步骤**:
1. 打开 Unity Console 或设备日志工具
2. 在游戏中调用 `ScreenShotObserver.Instance.StartListenScreenShot(null, null, true)`
3. 观察日志输出
4. 在游戏中调用 `ScreenShotObserver.Instance.StartListenScreenShot("", "", true)`
5. 观察日志输出

**预期结果**:
- ✅ 步骤 3：日志中应显示错误日志，提示参数为空
- ✅ 步骤 5：日志中应显示错误日志，提示参数为空字符串
- ✅ 游戏不应崩溃或出现异常

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 5：边界测试 - 多次启动监听

**测试目的**: 验证多次启动监听时的行为

**前置条件**:
- 游戏已启动并进入主界面

**测试步骤**:
1. 打开 Unity Console 或设备日志工具
2. 连续调用 3 次 `StartListenScreenShot("NativeMsgRx", "OnScreenshotDetected", true)`
3. 观察日志输出
4. 执行一次截屏操作
5. 观察日志输出

**预期结果**:
- ✅ 步骤 3：第 1 次调用应成功；第 2/3 次调用应提示已在监听中（必须先 Stop 才能再次 Start），不应崩溃
- ✅ 步骤 5：应只收到一次截屏回调（不应重复触发）

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 6：边界测试 - 多次停止监听

**测试目的**: 验证多次停止监听时的行为

**前置条件**:
- 游戏已启动
- 已启动截屏监听

**测试步骤**:
1. 打开 Unity Console 或设备日志工具
2. 连续调用 3 次 `StopListenScreenShot()`
3. 观察日志输出
4. 执行一次截屏操作
5. 观察日志输出

**预期结果**:
- ✅ 步骤 3：每次调用都应成功，不应报错
- ✅ 步骤 5：不应收到截屏回调（监听已停止）

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 7：状态切换测试 - 启动-停止-启动循环

**测试目的**: 验证监听状态的正常切换

**前置条件**:
- 游戏已启动并进入主界面

**测试步骤**:
1. 打开 Unity Console 或设备日志工具
2. 调用 `StartListenScreenShot("NativeMsgRx", "OnScreenshotDetected", true)` 启动监听
3. 等待 1 秒
4. 调用 `StopListenScreenShot()` 停止监听
5. 等待 1 秒
6. 调用 `StartListenScreenShot("NativeMsgRx", "OnScreenshotDetected", true)` 再次启动监听
7. 等待 1 秒
8. 执行截屏操作
9. 观察日志输出

**预期结果**:
- ✅ 步骤 8：应能正常收到截屏回调
- ✅ 所有状态切换应流畅，无异常

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 8：平台兼容性 - Android 不同版本测试

**测试目的**: 验证 Android 不同版本下的兼容性

**前置条件**:
- 准备 Android 14+ (API 34) 设备一台
- 准备 Android < 14 设备一台

**测试步骤**:
1. 在 Android 14+ 设备上：
   - 启动监听
   - 执行截屏操作
   - 观察日志输出
2. 在 Android < 14 设备上：
   - 启动监听
   - 执行截屏操作
   - 观察日志输出

**预期结果**:
- ✅ Android 14+：应使用官方 API 检测截屏，日志中可能显示 "Android 14+ Strategy"
- ✅ Android < 14：应使用 ContentObserver 检测截屏，日志中可能显示 "Legacy Strategy"
- ✅ 两种方式都应能正常检测到截屏

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 9：性能测试 - 长时间运行

**测试目的**: 验证长时间运行时的稳定性

**前置条件**:
- 游戏已启动并进入主界面

**测试步骤**:
1. 启动截屏监听
2. 让游戏运行 30 分钟
3. 每 5 分钟执行一次截屏操作
4. 观察日志输出和内存使用情况
5. 停止监听

**预期结果**:
- ✅ 每次截屏都应能正常检测到
- ✅ 内存使用应保持稳定，无明显泄漏
- ✅ 游戏运行流畅，无卡顿

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 10：集成测试 - 与 SDKManager 集成

**测试目的**: 验证通过 SDKManager 调用是否正常

**前置条件**:
- 游戏已启动并进入主界面
- SDKManager 已初始化

**测试步骤**:
1. 打开 Unity Console 或设备日志工具
2. 通过 Lua 或 C# 调用 `SDKManager.Instance.StartListenScreenShot()`
3. 观察日志输出
4. 执行截屏操作
5. 观察日志输出
6. 调用 `SDKManager.Instance.StopListenScreenShot()`
7. 观察日志输出

**预期结果**:
- ✅ 步骤 3：应能正常启动监听
- ✅ 步骤 5：应能正常收到截屏回调
- ✅ 步骤 7：应能正常停止监听

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 11：异常场景 - GameObject 不存在

**测试目的**: 验证当指定的 GameObject 不存在时的行为

**前置条件**:
- 游戏已启动并进入主界面
- 确认场景中不存在名为 `NonExistentGO` 的 GameObject

**测试步骤**:
1. 打开 Unity Console 或设备日志工具
2. 调用 `StartListenScreenShot("NonExistentGO", "OnScreenshot", true)`
3. 观察日志输出
4. 执行截屏操作
5. 观察日志输出

**预期结果**:
- ✅ 步骤 3：应能正常启动监听（原生层会注册，但回调可能失败）
- ✅ 步骤 5：可能不会收到回调（因为 GameObject 不存在），但不应崩溃

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

### 测试用例 12：异常场景 - 方法不存在

**测试目的**: 验证当指定的方法不存在时的行为

**前置条件**:
- 游戏已启动并进入主界面
- 已创建一个名为 `TestGO` 的 GameObject，但该 GameObject 上**没有** `OnScreenshot` 方法

**测试步骤**:
1. 打开 Unity Console 或设备日志工具
2. 调用 `StartListenScreenShot("TestGO", "OnScreenshot", true)`
3. 观察日志输出
4. 执行截屏操作
5. 观察日志输出

**预期结果**:
- ✅ 步骤 3：应能正常启动监听
- ✅ 步骤 5：可能不会收到回调（因为方法不存在），但不应崩溃
- ✅ 日志中可能显示 Unity 的警告信息，提示方法未找到

**实际结果**: 
- [ ] 通过
- [ ] 失败（请记录错误信息）

**备注**: _________________________________________________

---

## 三、回归测试检查清单

在每次版本更新后，请执行以下快速回归测试：

- [ ] **基础功能**：启动监听 → 截屏 → 收到回调 → 停止监听
- [ ] **参数验证**：空参数测试不应崩溃
- [ ] **状态切换**：启动-停止-启动循环测试
- [ ] **平台兼容**：Android 14+ 和 Android < 14 各测试一次
- [ ] **集成测试**：通过 SDKManager 调用测试

---

## 四、问题记录模板

### Bug 报告格式

**Bug ID**: BUG-YYYYMMDD-XXX  
**发现日期**: YYYY-MM-DD  
**测试人员**: ___________  
**严重程度**: [ ] 严重 [ ] 一般 [ ] 轻微  
**优先级**: [ ] 高 [ ] 中 [ ] 低  

**问题描述**:
_________________________________________________
_________________________________________________

**复现步骤**:
1. _________________________________________________
2. _________________________________________________
3. _________________________________________________

**预期结果**:
_________________________________________________

**实际结果**:
_________________________________________________

**测试环境**:
- 设备型号: _______________
- 系统版本: _______________
- Unity 版本: _______________
- 插件版本: _______________

**日志信息**:
```
（请粘贴相关日志）
```

**截图/视频**:
（如有，请附上）

---

## 五、测试通过标准

### 必须通过的测试用例

以下测试用例必须全部通过才能认为功能正常：

1. ✅ 测试用例 1：基础功能 - 启动监听（默认参数）
2. ✅ 测试用例 2：基础功能 - 启动监听（自定义参数）
3. ✅ 测试用例 3：基础功能 - 停止监听
4. ✅ 测试用例 4：异常处理 - 空参数测试
5. ✅ 测试用例 8：平台兼容性 - Android 不同版本测试

### 建议通过的测试用例

以下测试用例建议通过，但不强制：

- 测试用例 5-7：边界测试
- 测试用例 9：性能测试
- 测试用例 10：集成测试
- 测试用例 11-12：异常场景

---

## 六、常见问题 FAQ

### Q1: 在 Editor 模式下测试，为什么没有收到截屏回调？

**A**: Editor 模式下插件只会记录日志，不会实际监听截屏。需要在真机上进行测试。

### Q2: Android 设备上截屏后没有收到回调？

**A**: 请检查：
1. 是否成功启动了监听（查看日志）
2. 设备系统版本（Android 14+ 和 < 14 实现方式不同）
3. 是否有其他应用占用了截屏监听
4. 检查 Logcat 是否有相关错误日志

### Q3: iOS 设备上截屏后没有收到回调？

**A**: 请检查：
1. 是否成功启动了监听（查看日志）
2. Xcode Console 是否有相关错误
3. 确认回调方法签名正确：`public void MethodName(string filePath)`

### Q4: 多次启动监听会有问题吗？

**A**: 需要先 Stop 才能再次 Start。重复 Start 会被忽略，并输出提示日志（不崩溃、不重复注册）。

### Q5: 停止监听后再次启动，功能是否正常？

**A**: 正常。可以随时启动和停止监听，状态切换是安全的。

---

## 七、测试报告模板

### 测试总结

**测试日期**: YYYY-MM-DD  
**测试人员**: ___________  
**测试版本**: v1.0.0  
**测试平台**: [ ] Android [ ] iOS  

**测试结果统计**:
- 总测试用例数: 12
- 通过用例数: ___
- 失败用例数: ___
- 通过率: ___%

**测试结论**:
- [ ] 通过，可以发布
- [ ] 有条件通过（需修复轻微问题）
- [ ] 不通过（存在严重问题）

**主要问题**:
1. _________________________________________________
2. _________________________________________________
3. _________________________________________________

**测试备注**:
_________________________________________________
_________________________________________________

---

## 八、附录

### A. 日志关键字

测试时可在日志中搜索以下关键字：

- `[ScreenShotObserver]` - 插件主日志
- `[ScreenshotCallbackReceiver]` - 回调接收器日志
- `Screenshot detected` - 截屏检测成功
- `Start listening` - 启动监听
- `Stop listening` - 停止监听
- `Android 14+ Strategy` - Android 14+ 实现方式
- `Legacy Strategy` - Android < 14 实现方式

### B. 联系方式

如遇到问题或需要技术支持，请联系：
- 开发负责人: _______________
- 技术支持: _______________

---

**文档版本**: v1.0  
**最后更新**: YYYY-MM-DD  
**维护人员**: _______________

